<!DOCTYPE html>
<html>
<head>
    <title>网页监控面板</title>
    <style>
        #monitorBtn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 24px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        #panel {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 400px;
            height: 500px;
            background: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
            display: none;
            flex-direction: column;
        }

        #dataContainer {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        iframe {
            width: 100%;
            height: 100vh;
            border: none;
        }
    </style>
</head>
<body>
    <iframe id="mainFrame" src="http://md.yituike.com"></iframe>

    <button id="monitorBtn">显示监控面板</button>
    
    <div id="panel">
        <div id="dataContainer"></div>
    </div>

    <script>
        // 拦截XMLHttpRequest
        const originalXHR = window.XMLHttpRequest;
        window.XMLHttpRequest = function() {
            const xhr = new originalXHR();
            
            xhr.addEventListener('load', function() {
                logData({
                    type: '响应',
                    url: this.responseURL,
                    status: this.status,
                    data: this.responseText
                });
            });

            return xhr;
        };

        // 拦截Fetch API
        const originalFetch = window.fetch;
        window.fetch = async function(...args) {
            const response = await originalFetch(...args);
            
            response.clone().json().then(data => {
                logData({
                    type: '请求',
                    url: response.url,
                    status: response.status,
                    data: JSON.stringify(data)
                });
            }).catch(() => {});

            return response;
        };

        // 数据记录
        let requests = [];
        function logData(data) {
            requests.push(data);
            updatePanel();
        }

        // 更新监控面板
        function updatePanel() {
            const container = document.getElementById('dataContainer');
            container.innerHTML = requests.map((req, i) => 
                `<div style="margin-bottom:10px;padding:10px;background:#f5f5f5;">
                    <strong>${req.type} ${i+1}:</strong><br>
                    URL: ${req.url}<br>
                    状态码: ${req.status}<br>
                    数据: ${req.data}
                </div>`
            ).join('');
        }

        // 面板控制
        document.getElementById('monitorBtn').addEventListener('click', () => {
            const panel = document.getElementById('panel');
            panel.style.display = panel.style.display === 'none' ? 'flex' : 'none';
        });
    </script>
</body>
</html>
