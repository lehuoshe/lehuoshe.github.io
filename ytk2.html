<!DOCTYPE html>
<html>
<head>
    <title>网页监控面板</title>
    <style>
        #monitorBtn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 24px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        #panel {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 400px;
            height: 500px;
            background: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
            display: none;
            flex-direction: column;
        }

        #dataContainer {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        iframe {
            width: 100%;
            height: 100vh;
            border: none;
        }
    </style>
</head>
<body>
    <iframe id="mainFrame" src="http://md.yituike.com/pages/my/index"></iframe>

    <script>
        // 在iframe加载完成后注入监控代码
        document.getElementById('mainFrame').addEventListener('load', function() {
            const iframeWindow = this.contentWindow;

            // 重写iframe内部的XMLHttpRequest
            const originalXHR = iframeWindow.XMLHttpRequest;
            iframeWindow.XMLHttpRequest = function() {
                const xhr = new originalXHR();
                xhr.addEventListener('load', function() {
                    logData({
                        type: '响应',
                        url: this.responseURL,
                        status: this.status,
                        data: this.responseText.substring(0, 500) + '...' // 限制数据长度
                    });
                });
                return xhr;
            };

            // 重写iframe内部的Fetch API
            const originalFetch = iframeWindow.fetch;
            iframeWindow.fetch = async function(...args) {
                const response = await originalFetch(...args);
                response.clone().text().then(data => {
                    logData({
                        type: '请求',
                        url: response.url,
                        status: response.status,
                        data: data.substring(0, 500) + '...'
                    });
                });
                return response;
            };
        });

        // 增加自动滚动功能
        function updatePanel() {
            const container = document.getElementById('dataContainer');
            container.innerHTML = requests.map((req, i) => 
                `<div style="margin:10px;padding:10px;background:#fff;border-radius:4px;box-shadow:0 1px 3px rgba(0,0,0,0.1);">
                    <small>${new Date().toLocaleTimeString()}</small>
                    <div style="color:${req.type === '请求' ? '#4CAF50' : '#2196F3'};">
                        <strong>${req.type} ${i+1}</strong>
                    </div>
                    <div style="word-break:break-all;margin-top:5px;">
                        ${req.url}<br>
                        状态: ${req.status}<br>
                        数据: ${req.data || '无'}
                    </div>
                </div>`
            ).join('');
            container.scrollTop = container.scrollHeight;
        }
    </script>
    <button id="monitorBtn">显示监控面板</button>
    
    <div id="panel">
        <div id="dataContainer"></div>
    </div>

    <script>
        // 拦截XMLHttpRequest
        const originalXHR = window.XMLHttpRequest;
        window.XMLHttpRequest = function() {
            const xhr = new originalXHR();
            
            xhr.addEventListener('load', function() {
                logData({
                    type: '响应',
                    url: this.responseURL,
                    status: this.status,
                    data: this.responseText
                });
            });

            return xhr;
        };

        // 拦截Fetch API
        const originalFetch = window.fetch;
        window.fetch = async function(...args) {
            const response = await originalFetch(...args);
            
            response.clone().json().then(data => {
                logData({
                    type: '请求',
                    url: response.url,
                    status: response.status,
                    data: JSON.stringify(data)
                });
            }).catch(() => {});

            return response;
        };

        // 数据记录
        let requests = [];
        function logData(data) {
            requests.push(data);
            updatePanel();
        }

        // 更新监控面板
        function updatePanel() {
            const container = document.getElementById('dataContainer');
            container.innerHTML = requests.map((req, i) => 
                `<div style="margin-bottom:10px;padding:10px;background:#f5f5f5;">
                    <strong>${req.type} ${i+1}:</strong><br>
                    URL: ${req.url}<br>
                    状态码: ${req.status}<br>
                    数据: ${req.data}
                </div>`
            ).join('');
        }

        // 面板控制
        document.getElementById('monitorBtn').addEventListener('click', () => {
            const panel = document.getElementById('panel');
            panel.style.display = panel.style.display === 'none' ? 'flex' : 'none';
        });
    </script>
</body>
</html>
